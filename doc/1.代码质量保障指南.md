# ä»£ç è´¨é‡ä¿éšœæŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬é¡¹ç›®å·²æˆåŠŸé›†æˆå®Œæ•´çš„ä»£ç è´¨é‡ä¿éšœä½“ç³»ï¼ŒåŒ…æ‹¬æµ‹è¯•è¦†ç›–ã€é™æ€åˆ†æã€ä»£ç é£æ ¼æ£€æŸ¥å’Œç»¼åˆè´¨é‡è¯„ä¼°å·¥å…·ã€‚

## ğŸ§ª æµ‹è¯•ä½“ç³»

### å·²æ·»åŠ çš„æµ‹è¯•
- **æ ¸å¿ƒæ¨¡å— (Core)**ï¼š
    - `PluginConfigurationManagerTest.java` - é…ç½®ç®¡ç†å™¨å•å…ƒæµ‹è¯•
    - `PluginConfigurationTest.java` - é…ç½®å®ä½“å•å…ƒæµ‹è¯•
    - `PluginSecurityManagerTest.java` - å®‰å…¨ç®¡ç†å™¨å•å…ƒæµ‹è¯•

- **åŠ è½½å™¨æ¨¡å— (Loader)**ï¼š
    - `AbstractLauncherTest.java` - æŠ½è±¡å¯åŠ¨å™¨å•å…ƒæµ‹è¯•
    - `MainMethodRunnerTest.java` - ä¸»æ–¹æ³•è¿è¡Œå™¨å•å…ƒæµ‹è¯•

- **é›†æˆæµ‹è¯•**ï¼š
    - `PluginLifecycleIntegrationTest.java` - æ’ä»¶ç”Ÿå‘½å‘¨æœŸç®¡ç†é›†æˆæµ‹è¯•

### è¿è¡Œæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
mvn test

# è¿è¡Œç‰¹å®šæ¨¡å—æµ‹è¯•
mvn test -pl spring-boot3-brick-bootkit-core
mvn test -pl spring-boot3-brick-bootkit-loader

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
mvn test jacoco:report

# æŸ¥çœ‹è¦†ç›–ç‡æŠ¥å‘Š
open target/site/jacoco/index.html
```

## ğŸ” ä»£ç è´¨é‡å·¥å…·

### 1. JaCoCo - æµ‹è¯•è¦†ç›–ç‡

**é…ç½®ä½ç½®**: `pom.xml`

**åŠŸèƒ½**:
- 80% è¡Œè¦†ç›–ç‡è¦æ±‚
- è‡ªåŠ¨ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
- é›†æˆåœ¨ Maven æ„å»ºæµç¨‹ä¸­

**ä½¿ç”¨**:
```bash
# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
mvn test jacoco:report

# æ£€æŸ¥è¦†ç›–ç‡ï¼ˆä¼šå¤±è´¥å¦‚æœä½äº80%ï¼‰
mvn jacoco:check
```

**è¾“å‡º**:
- HTMLæŠ¥å‘Š: `target/site/jacoco/index.html`
- XMLæŠ¥å‘Š: `target/site/jacoco/jacoco.xml`
- CSVæŠ¥å‘Š: `target/site/jacoco/jacoco.csv`

### 2. SpotBugs - Bugæ£€æµ‹

**é…ç½®æ–‡ä»¶**: `spotbugs-exclude.xml`

**åŠŸèƒ½**:
- æ£€æµ‹æ½œåœ¨çš„Bug
- é™æ€ä»£ç åˆ†æ
- å®‰å…¨é—®é¢˜è¯†åˆ«

**ä½¿ç”¨**:
```bash
# è¿è¡ŒSpotBugsæ£€æŸ¥
mvn spotbugs:check

# ç”ŸæˆSpotBugsæŠ¥å‘Š
mvn spotbugs:spotbugs

# æŸ¥çœ‹æŠ¥å‘Š
open target/spotbugsXmlOutputDirectory/spotbugsXml.html
```

### 3. Checkstyle - ä»£ç é£æ ¼

**é…ç½®æ–‡ä»¶**:
- `checkstyle.xml` - ä¸»é…ç½®æ–‡ä»¶
- `checkstyle-suppressions.xml` - æŠ‘åˆ¶è§„åˆ™

**åŠŸèƒ½**:
- ä»£ç æ ¼å¼è§„èŒƒæ£€æŸ¥
- å‘½åçº¦å®šæ£€æŸ¥
- æ³¨é‡Šè´¨é‡æ£€æŸ¥

**ä½¿ç”¨**:
```bash
# è¿è¡ŒCheckstyleæ£€æŸ¥
mvn checkstyle:check

# ç”ŸæˆCheckstyleæŠ¥å‘Š
mvn checkstyle:checkstyle
```

**è¾“å‡º**:
- æŠ¥å‘Šæ–‡ä»¶: `target/checkstyle-result.xml`

### 4. PMD - ä»£ç è´¨é‡

**é…ç½®æ–‡ä»¶**: `pmd-ruleset.xml`

**åŠŸèƒ½**:
- æœ€ä½³å®è·µæ£€æŸ¥
- ä»£ç å¤æ‚åº¦åˆ†æ
- æ€§èƒ½é—®é¢˜æ£€æµ‹

**ä½¿ç”¨**:
```bash
# è¿è¡ŒPMDæ£€æŸ¥
mvn pmd:check

# ç”ŸæˆPMDæŠ¥å‘Š
mvn pmd:pmd

# æŸ¥çœ‹æŠ¥å‘Š
open target/pmd.xml
```

### 5. SonarQube - ç»¼åˆè´¨é‡è¯„ä¼°

**é…ç½®æ–‡ä»¶**:
- `sonar-project.properties` - ä¸»é…ç½®æ–‡ä»¶
- å„æ¨¡å—çš„ç‹¬ç«‹é…ç½®æ–‡ä»¶

**åŠŸèƒ½**:
- ç»¼åˆä»£ç è´¨é‡åˆ†æ
- æŠ€æœ¯å€ºåŠ¡è¯„ä¼°
- å®‰å…¨æ¼æ´æ£€æµ‹
- ä»£ç å¼‚å‘³åˆ†æ

**ä½¿ç”¨**:
```bash
# æœ¬åœ°è¿è¡ŒSonarQubeåˆ†æ
mvn sonar:sonar

# ä¸è¿œç¨‹SonarQubeæœåŠ¡å™¨é›†æˆ
mvn sonar:sonar -Dsonar.host.url=http://your-sonarqube-server
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. è¿è¡Œå®Œæ•´è´¨é‡æ£€æŸ¥

```bash
# ä¸€æ¬¡æ€§è¿è¡Œæ‰€æœ‰è´¨é‡å·¥å…·
mvn clean test spotbugs:check checkstyle:check pmd:check jacoco:check
```

### 2. ä½¿ç”¨Maven Profile

```bash
# å¯ç”¨è´¨é‡æ£€æŸ¥profileï¼ˆé»˜è®¤å¯ç”¨dev profileæ—¶è·³è¿‡ï¼‰
mvn clean install -P release

# å¼€å‘ç¯å¢ƒï¼ˆè·³è¿‡æŸäº›æ£€æŸ¥ï¼‰
mvn test -P dev
```

### 3. è®¾ç½®æŒç»­é›†æˆ

åœ¨CI/CDæµæ°´çº¿ä¸­é›†æˆè¿™äº›å·¥å…·ï¼š

```yaml
# GitHub Actions ç¤ºä¾‹
- name: Run Quality Checks
  run: |
    mvn clean test jacoco:report
    mvn spotbugs:check
    mvn checkstyle:check
    mvn pmd:check
    mvn sonar:sonar -Dsonar.host.url=${{ secrets.SONAR_HOST_URL }} -Dsonar.login=${{ secrets.SONAR_TOKEN }}
```

## ğŸ“Š è´¨é‡æŒ‡æ ‡

### è¦†ç›–ç‡è¦æ±‚
- **æœ€ä½è¦æ±‚**: 80% è¡Œè¦†ç›–ç‡
- **æµ‹è¯•è¦†ç›–æ¨¡å—**:
    - Core æ¨¡å—ï¼ˆé…ç½®ç®¡ç†ã€å®‰å…¨ç®¡ç†ã€ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼‰
    - Loader æ¨¡å—ï¼ˆå¯åŠ¨å™¨ã€è¿è¡Œå™¨ï¼‰

### ä»£ç è´¨é‡é˜ˆå€¼
- **SpotBugs**: Mediumçº§åˆ«åŠä»¥ä¸Šçš„Bugå°†è¢«é˜»æ­¢æ„å»º
- **Checkstyle**: ä»»ä½•æ ¼å¼é”™è¯¯éƒ½å°†å¯¼è‡´æ„å»ºå¤±è´¥
- **PMD**: Mediumçº§åˆ«åŠä»¥ä¸Šçš„è¿è§„å°†è¢«é˜»æ­¢æ„å»º

## ğŸ”§ è‡ªå®šä¹‰é…ç½®

### ä¿®æ”¹è¦†ç›–ç‡é˜ˆå€¼
ç¼–è¾‘ `pom.xml`:
```xml
<jacoco.check.percentage>90</jacoco.check.percentage>
```

### æ·»åŠ è‡ªå®šä¹‰Checkstyleè§„åˆ™
ç¼–è¾‘ `checkstyle.xml` å’Œ `checkstyle-suppressions.xml`

### é…ç½®SpotBugsæ’é™¤è§„åˆ™
ç¼–è¾‘ `spotbugs-exclude.xml`

### è°ƒæ•´PMDè§„åˆ™
ç¼–è¾‘ `pmd-ruleset.xml`

### SonarQubeé¡¹ç›®é…ç½®
ç¼–è¾‘ç›¸åº”çš„ `sonar-project.properties` æ–‡ä»¶

## ğŸ“ æµ‹è¯•æœ€ä½³å®è·µ

### ç¼–å†™é«˜è´¨é‡æµ‹è¯•
1. **å‘½åè§„èŒƒ**: ä½¿ç”¨æè¿°æ€§çš„æµ‹è¯•æ–¹æ³•å
2. **AAAæ¨¡å¼**: Arrange-Act-Assert
3. **è¦†ç›–ç‡**: ç¡®ä¿å…³é”®ä¸šåŠ¡é€»è¾‘100%è¦†ç›–
4. **éš”ç¦»æ€§**: æµ‹è¯•ä¹‹é—´ç›¸äº’ç‹¬ç«‹
5. **å¯è¯»æ€§**: æ¸…æ™°çš„æµ‹è¯•ä»£ç 

### æµ‹è¯•ç±»å‹
- **å•å…ƒæµ‹è¯•**: æµ‹è¯•å•ä¸ªç±»æˆ–æ–¹æ³•çš„é€»è¾‘
- **é›†æˆæµ‹è¯•**: æµ‹è¯•ç»„ä»¶é—´çš„äº¤äº’
- **ç³»ç»Ÿæµ‹è¯•**: æµ‹è¯•æ•´ä¸ªæ’ä»¶ç”Ÿå‘½å‘¨æœŸ

## ğŸš¨ å¸¸è§é—®é¢˜

### æ„å»ºå¤±è´¥å¤„ç†
1. **æµ‹è¯•å¤±è´¥**: ä¿®å¤å¤±è´¥çš„æµ‹è¯•ç”¨ä¾‹
2. **è¦†ç›–ç‡ä¸è¶³**: æ·»åŠ æ›´å¤šæµ‹è¯•ç”¨ä¾‹
3. **SpotBugs/PMDé”™è¯¯**: ä¿®å¤æŠ¥å‘Šçš„é—®é¢˜æˆ–æ·»åŠ åˆç†æ’é™¤
4. **Checkstyleé”™è¯¯**: è°ƒæ•´ä»£ç æ ¼å¼

### æ€§èƒ½ä¼˜åŒ–
```bash
# å¹¶è¡Œè¿è¡Œæµ‹è¯•
mvn test -T 1C

# è·³è¿‡è€—æ—¶æµ‹è¯•ï¼ˆå¼€å‘é˜¶æ®µï¼‰
mvn test -DskipITs
```

## ğŸ“ æ”¯æŒ

å¦‚æœ‰è´¨é‡é—®é¢˜éœ€è¦å¸®åŠ©ï¼Œè¯·ï¼š
1. æŸ¥çœ‹ç›¸å…³å·¥å…·çš„è¯¦ç»†æ–‡æ¡£
2. æ£€æŸ¥Mavenæ„å»ºè¾“å‡ºä¸­çš„å…·ä½“é”™è¯¯ä¿¡æ¯
3. è¿è¡Œå•ç‹¬çš„å·¥å…·æœ‰åŠ©äºå®šä½é—®é¢˜

---

**æ³¨æ„**: æœ¬è´¨é‡ä¿éšœä½“ç³»æ˜¯å¼€å‘æµç¨‹çš„é‡è¦ç»„æˆéƒ¨åˆ†ï¼Œå»ºè®®åœ¨æ¯æ¬¡æäº¤å‰è¿è¡Œç›¸å…³æ£€æŸ¥ã€‚